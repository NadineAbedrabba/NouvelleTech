<div class="review-container">
    <div class="floating-food">
      <div class="food-icon">ğŸ•</div>
      <div class="food-icon">ğŸ£</div>
      <div class="food-icon">ğŸ”</div>
    </div>
  
    <h1 class="review-title pulse">Donnez votre avis</h1>
    
    <!-- Message d'erreur -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    
    <div class="review-card wobble">
      <!-- Note globale -->
      <div class="overall-rating">
        <div class="rating-bubble">
          <div class="rating-value">{{ overallRating.toFixed(1) }}</div>
          <div class="rating-max">/5</div>
        </div>
        <h3>Votre Note Globale</h3>
        <div class="stars">
          <span *ngFor="let star of [1,2,3,4,5]" 
                [class.filled]="star <= overallRating"
                [class.bounce]="star <= overallRating">â˜…</span>
        </div>
      </div>
  
      <!-- Formulaire -->
      <form class="review-form" (ngSubmit)="submitReview()">
        <!-- SÃ©lecteur d'entreprise (visible uniquement si l'entreprise n'est pas spÃ©cifiÃ©e dans l'URL) -->
        <div class="form-group" *ngIf="!entrepriseSpecifiee">
          <div class="custom-select">
            <select [(ngModel)]="entrepriseId" name="entreprise" (change)="onEntrepriseChange($event)" required>
              <option [ngValue]="null" disabled selected>SÃ©lectionnez un restaurant</option>
              <option *ngFor="let entreprise of entreprises" [ngValue]="entreprise.id">
                {{ entreprise.nomEntreprise }}
              </option>
            </select>
            <div class="select-arrow">â–¼</div>
          </div>
        </div>
        
        <!-- Affichage de l'entreprise sÃ©lectionnÃ©e si spÃ©cifiÃ©e dans l'URL -->
        <div class="selected-entreprise" *ngIf="entrepriseSpecifiee && entrepriseSelectionnee">
          <h3>Avis pour : {{ entrepriseSelectionnee.nomEntreprise }}</h3>
        </div>
        <!-- Commentaire -->
        <div class="form-group floating-label">
          <textarea id="reviewText" [(ngModel)]="reviewText" name="reviewText" required></textarea>
          <label for="reviewText">Ã‰crivez votre avis*</label>
          <div class="underline"></div>
        </div>
  
        <!-- Notes -->
        <div class="rating-categories">
          <div class="rating-category" *ngFor="let category of ratingCategories">
            <label>{{category.label}}</label>
            <div class="star-rating">
              <span *ngFor="let star of [1,2,3,4,5]" 
                    (click)="category.rating = star"
                    [class.active]="star <= category.rating"
                    [class.jump]="star === category.rating">â˜…</span>
            </div>
          </div>
        </div>
  
        <!-- SÃ©lecteurs -->
        <div class="selector-group">
          <div class="custom-select">
            <select [(ngModel)]="companion" name="companion">
              <option value="" disabled selected>Avec qui ?</option>
              <option *ngFor="let option of companionOptions" [value]="option">
                {{ option === 'FAMILLE' ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Famille' :
                   option === 'AMIS' ? 'ğŸ‘¯â€â™€ï¸ Amis' :
                   option === 'COUPLE' ? 'ğŸ’‘ Couple' :
                   option === 'COLLEGUES' ? 'ğŸ‘” CollÃ¨gues' :
                   option === 'SEUL' ? 'ğŸ§â€â™‚ï¸ Seul(e)' : option }}
              </option>
            </select>
            <div class="select-arrow">â–¼</div>
          </div>

          <div class="custom-select">
            <select [(ngModel)]="occasion" name="occasion">
              <option value="" disabled selected>Pourquoi ?</option>
              <option *ngFor="let option of occasionOptions" [value]="option">
                {{ option === 'DINER' ? 'ğŸŒ™ DÃ®ner' :
                   option === 'DEJEUNER' ? 'â˜€ï¸ DÃ©jeuner' :
                   option === 'AFFAIRES' ? 'ğŸ’¼ Repas d\'affaires' :
                   option === 'CELEBRATION' ? 'ğŸ‰ CÃ©lÃ©bration' :
                   option === 'AUTRE' ? 'âœ¨ Autre' : option }}
              </option>
            </select>
            <div class="select-arrow">â–¼</div>
          </div>
        </div>
  
        <!-- Certification -->
        <div class="certification">
          <label class="checkbox-container">
            <input type="checkbox" [(ngModel)]="isCertified" name="certify" required>
            <span class="checkmark"></span>
            <span class="certify-text">Je certifie que cet avis reflÃ¨te ma propre expÃ©rience</span>
          </label>
        </div>
  
        <button type="submit" class="submit-btn" [disabled]="!isFormValid()">
          <span *ngIf="!isSubmitting">Envoyer l'avis ğŸš€</span>
          <span *ngIf="isSubmitting" class="submit-loading">
            <span class="loading-dot">.</span>
            <span class="loading-dot">.</span>
            <span class="loading-dot">.</span>
          </span>
        </button>
      </form>
    </div>
  </div>
